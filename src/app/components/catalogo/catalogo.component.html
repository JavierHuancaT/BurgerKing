<div class="catalogo-container">

  <div class="categorias">
    <button *ngFor="let cat of (categorias$ | async) || []"
            [class.activo]="cat === categoriaSeleccionada"
            (click)="seleccionarCategoria(cat)">
      {{ cat }}
    </button>
  </div>

  <h2 class="titulo-categoria">{{ categoriaSeleccionada }}</h2>

  <div class="grid-productos" *ngIf="(productosPorCategoria$ | async) as map">
    <div class="producto-card" *ngFor="let producto of map[categoriaSeleccionada || '']">

      <div class="promo-badge" *ngIf="producto.descuento > 0">-{{ producto.descuento }}%</div>

      <img [src]="producto.imagen" [alt]="producto.nombre"/>
      <h3>{{ producto.nombre }}</h3>
      <p class="descripcion-producto">{{ producto.descripcion }}</p>

      <p class="precio-producto">
        <span *ngIf="producto.descuento > 0" class="tachado">
          {{ producto.precio | currency:'CLP':'symbol':'1.0-0' }}
        </span>
        <strong>
          {{ producto.precioOferta | currency:'CLP':'symbol':'1.0-0' }}
        </strong>
      </p>

      <div class="selector-cantidad">
        <button (click)="cambiarCantidad(producto.id, -1); $event.stopPropagation()">−</button>
        <span>{{ cantidadDe(producto.id) }}</span>
        <button (click)="cambiarCantidad(producto.id, 1);  $event.stopPropagation()">+</button>
      </div>

      <div class="botones-accion">
        <button class="btn-agregar" (click)="agregarAlCarrito(producto); $event.stopPropagation()">
          Agregar al carrito
        </button>
        
        <!--el botón "Personalizar" debe enviar la cantidad que el usuario seleccionó en el contador (- 1 +). 
        Si no lo hacemos, la siguiente pantalla no sabe si quieres 1 o 10-->
        <a [routerLink]="['/personalizar', producto.id]" 
           [queryParams]="{ quantity: cantidadDe(producto.id) }"
           class="btn-personalizar" 
           *ngIf="producto.personalizaciones && producto.personalizaciones.length > 0">
          Personalizar
        </a>
      </div>
    </div>
  </div>
</div>
<style>
  .botones-accion {
    display: flex;
    gap: 8px;
    width: 100%;
  }
  .btn-agregar, .btn-personalizar {
    flex-grow: 1;
  }
  .btn-personalizar {
    background-color: var(--bk-orange);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
  }
</style>
